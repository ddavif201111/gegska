<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root { --accent: #f1c40f; --neon: #00f2ff; --purple: #7000ff; }
        body { background: #050505; color: white; font-family: sans-serif; text-align: center; margin: 0; overflow: hidden; }
        .bg { position: fixed; top: 0; width: 100%; height: 100%; background: radial-gradient(circle at 50% 20%, #1e0044 0%, transparent 50%); z-index: -1; }
        #bal { font-size: 64px; font-weight: 900; color: var(--accent); margin: 20px 0; text-shadow: 0 0 20px rgba(241,196,15,0.5); }
        #coin { width: 250px; height: 250px; border-radius: 50%; background: linear-gradient(145deg, #1a1a1a, #000); display: inline-flex; align-items: center; justify-content: center; font-size: 110px; border: 4px solid var(--purple); box-shadow: 0 0 40px #000, inset 0 0 20px rgba(112,0,255,0.3); cursor: pointer; transition: transform 0.05s; touch-action: none; -webkit-user-select: none; }
        #coin:active { transform: scale(0.92); }
        .panel { background: rgba(255,255,255,0.05); border-radius: 20px; width: 85%; margin: 15px auto; padding: 15px; border: 1px solid rgba(255,255,255,0.1); }
        .bar { background: #111; height: 14px; border-radius: 7px; margin-top: 10px; overflow: hidden; border: 1px solid #333; }
        #fill { background: linear-gradient(90deg, var(--neon), var(--purple)); height: 100%; width: 100%; transition: 0.2s; }
        .nav { position: fixed; bottom: 0; width: 100%; display: flex; background: #111; border-top: 1px solid #333; padding-bottom: 15px; }
        .nav button { flex: 1; padding: 15px; background: none; border: none; color: #888; font-weight: bold; font-size: 12px; }
        .nav button.active { color: var(--neon); border-top: 2px solid var(--neon); }
        .page { display: none; padding-top: 10px; height: 80vh; overflow-y: auto; }
        .page.active { display: block; }
        .item { background: rgba(255,255,255,0.05); margin: 10px 20px; padding: 15px; border-radius: 15px; border: 1px solid #333; display: flex; justify-content: space-between; align-items: center; }
        .btn { background: var(--neon); color: #000; border: none; padding: 10px 15px; border-radius: 10px; font-weight: bold; cursor: pointer; }
        .btn:disabled { background: #444; color: #777; }
        .check-btn { background: var(--accent); color: #000; display: none; }
    </style>
</head>
<body>
    <div class="bg"></div>
    <div style="padding-top:15px; color:var(--accent); font-weight:bold; font-size: 11px;">LVL: ELITE | –¢–ê–ü: <span id="tap-val">1</span></div>

    <div id="game-p" class="page active">
        <div id="bal">0</div>
        <div id="coin">üêπ</div>
        <div class="panel">
            <div style="display:flex; justify-content:space-between; font-size:13px; font-weight:bold;"><span>‚ö° –≠–ù–ï–†–ì–ò–Ø</span><span id="en-txt">2000 / 2000</span></div>
            <div class="bar"><div id="fill"></div></div>
        </div>
    </div>

    <div id="shop-p" class="page">
        <h2 style="color:var(--neon)">–ú–ê–ì–ê–ó–ò–ù</h2>
        <div class="item">
            <div style="text-align: left;"><b>–ú—É–ª—å—Ç–∏—Ç–∞–ø</b><br><small id="mt-cost">–¶–µ–Ω–∞: 2000</small></div>
            <button class="btn" id="mt-btn" onclick="buyMT()">–ö–£–ü–ò–¢–ò</button>
        </div>
        <div class="item">
            <div style="text-align: left;"><b>–ú–∞–∫—Å. –≠–Ω–µ—Ä–≥–∏—è</b><br><small id="en-cost">–¶–µ–Ω–∞: 2000</small></div>
            <button class="btn" id="en-btn" onclick="buyMaxEn()">–ö–£–ü–ò–¢–ò</button>
        </div>
    </div>

    <div id="tasks-p" class="page">
        <h2 style="color:var(--accent)">–ó–ê–î–ê–ù–ò–Ø</h2>
        <div class="item" id="task1_box">
            <div style="text-align: left;"><b>–ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –∫–∞–Ω–∞–ª</b><br><small>+50,000 –º–æ–Ω–µ—Ç</small></div>
            <div style="display: flex; gap: 5px;">
                <button class="btn" id="go_btn" onclick="startTask('https://t.me/—Ç–≤–æ–π_–∫–∞–Ω–∞–ª_—Ç—É—Ç')">–ü–ï–†–ï–ô–¢–ò</button>
                <button class="btn check-btn" id="check_btn" onclick="checkTask()">–ü–†–û–í–ï–†–ò–¢–¨</button>
            </div>
        </div>
    </div>

    <div class="nav">
        <button id="b-game" class="active" onclick="go('game')">–ò–ì–†–ê</button>
        <button id="b-shop" onclick="go('shop')">–ú–ê–ì–ê–ó–ò–ù</button>
        <button id="b-tasks" onclick="go('tasks')">–ó–ê–î–ê–ù–ò–Ø</button>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();

        let c = parseInt(localStorage.getItem('c')) || 0;
        let mt = parseInt(localStorage.getItem('m')) || 1;
        let maxEn = parseInt(localStorage.getItem('maxEn')) || 2000;
        let enLvl = parseInt(localStorage.getItem('enLvl')) || 1;
        let isSubbed = localStorage.getItem('isSubbed') === 'true';
        let en = maxEn;

        function upd() {
            let nextMtCost = mt * (mt + 1) * 1000;
            let nextEnCost = enLvl * (enLvl + 1) * 1000;
            document.getElementById('bal').innerText = c.toLocaleString();
            document.getElementById('en-txt').innerText = Math.floor(en) + " / " + maxEn;
            document.getElementById('fill').style.width = (en/maxEn*100) + "%";
            document.getElementById('tap-val').innerText = mt;
            document.getElementById('mt-cost').innerText = "–¶–µ–Ω–∞: " + nextMtCost.toLocaleString();
            document.getElementById('en-cost').innerText = "–¶–µ–Ω–∞: " + nextEnCost.toLocaleString();
            document.getElementById('mt-btn').disabled = (c < nextMtCost);
            document.getElementById('en-btn').disabled = (c < nextEnCost);

            if(isSubbed) document.getElementById('task1_box').style.display = 'none';

            localStorage.setItem('c', c);
            localStorage.setItem('m', mt);
            localStorage.setItem('maxEn', maxEn);
            localStorage.setItem('enLvl', enLvl);
            localStorage.setItem('isSubbed', isSubbed);
        }

        function tap(e) {
            if (e) e.preventDefault();
            if (en >= mt) {
                c += mt; en -= mt;
                tg.HapticFeedback.impactOccurred('light');
                upd();
            }
        }

        const coinBtn = document.getElementById('coin');
        coinBtn.ontouchstart = tap;
        coinBtn.onclick = tap;

        function go(p) {
            document.querySelectorAll('.page').forEach(x => x.classList.remove('active'));
            document.querySelectorAll('.nav button').forEach(x => x.classList.remove('active'));
            document.getElementById(p + '-p').classList.add('active');
            document.getElementById('b-' + p).classList.add('active');
        }

        window.buyMT = () => {
            let cost = mt * (mt + 1) * 1000;
            if (c >= cost) { c -= cost; mt++; upd(); tg.showAlert("–ú—É–ª—å—Ç–∏—Ç–∞–ø –ø—Ä–æ–∫–∞—á–∞–Ω!"); }
        };

        window.buyMaxEn = () => {
            let cost = enLvl * (enLvl + 1) * 1000;
            if (c >= cost) { c -= cost; enLvl++; maxEn += 500; en = maxEn; upd(); tg.showAlert("–≠–Ω–µ—Ä–≥–∏—è —É–≤–µ–ª–∏—á–µ–Ω–∞!"); }
        };

        // –õ–æ–≥—ñ–∫–∞ –∫–≤–µ—Å—Ç—É
        window.startTask = (url) => {
            tg.openTelegramLink(url);
            document.getElementById('go_btn').innerText = "–ì–û–¢–û–í–û";
            document.getElementById('check_btn').style.display = "block";
        };

        window.checkTask = () => {
            const btn = document.getElementById('check_btn');
            btn.innerText = "–ü–†–û–í–ï–†–ö–ê...";
            btn.disabled = true;

            setTimeout(() => {
                c += 40000;
                isSubbed = true;
                upd();
                tg.showAlert("–ü–æ–¥–ø–∏—Å–∫–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞! +50,000 –º–æ–Ω–µ—Ç");
            }, 5000); // 5 —Å–µ–∫—É–Ω–¥ —ñ–º—ñ—Ç–∞—Ü—ñ—ó –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏
        };

        setInterval(() => { if(en < maxEn){ en += 2; upd(); } }, 1000);
        upd();
    </script>
</body>
</html>
